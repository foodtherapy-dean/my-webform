<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì •ê¸°ê²€ì¦ ì…ë ¥í¼</title>

<style>
  body {
    margin:0;
    font-family: Arial;
    background:#f5f5f5;
  }

  /* ìƒë‹¨ë°”(ê³ ì •) */
  .header {
    position: fixed;
    top:0; left:0; right:0;
    background:#1976d2;
    color:white;
    padding:14px;
    font-size:20px;
    font-weight:bold;
    text-align:center;
    z-index:100;
  }

  /* í•˜ë‹¨ ì €ì¥ ë²„íŠ¼ë°”(ê³ ì •) */
  .footer {
    position: fixed;
    bottom:0; left:0; right:0;
    background:white;
    padding:10px;
    border-top:1px solid #ccc;
    text-align:center;
    z-index:100;
  }

  #saveBtn {
    width:90%;
    padding:14px;
    font-size:18px;
    border:none;
    background:#4caf50;
    color:white;
    border-radius:10px;
  }

  /* ë³¸ë¬¸ ì½˜í…ì¸  ì˜ì—­ */
  .content {
    padding:80px 16px 90px;
  }

  .hidden { display:none; }

  label { font-size:18px; }

  .input-box {
    background:white;
    padding:14px;
    margin-top:10px;
    border-radius:12px;
    box-shadow:0 2px 5px rgba(0,0,0,0.1);
  }

  select, input[type="date"] {
    width:100%;
    padding:10px;
    margin-top:8px;
    font-size:16px;
  }

  .toggle-btn {
    padding:12px 22px;
    border:1px solid #333;
    border-radius:12px;
    margin-right:10px;
    font-size:17px;
    cursor:pointer;
  }

  .toggle-btn.active {
    background:#4caf50;
    color:white;
  }

  .toggle-btn.inactive {
    background:#f44336;
    color:white;
  }
</style>
</head>

<body>

<div class="header">ì •ê¸°ê²€ì¦ ì…ë ¥í¼</div>

<div class="content">

  <div class="input-box">
    <label>ë‚ ì§œ</label>
    <input type="date" id="dateInput" />
  </div>

  <div class="input-box">
    <label>ì£¼ê¸° ì„ íƒ</label>
    <select id="periodSelect">
      <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
      <option value="ì£¼ê°„">ì£¼ê°„</option>
      <option value="ì›”ê°„">ì›”ê°„</option>
      <option value="ë¶„ê¸°">ë¶„ê¸°</option>
      <option value="ë°˜ê¸°">ë°˜ê¸°</option>
      <option value="ì—°ê°„">ì—°ê°„</option>
    </select>
  </div>

  <div class="input-box hidden" id="itemBox">
    <label>í•­ëª© ì„ íƒ</label>
    <select id="itemSelect">
      <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
    </select>
  </div>

  <div class="input-box hidden" id="statusBox">
    <label>ì ê²€ìƒíƒœ</label><br><br>
    <button id="btnDone" class="toggle-btn inactive">ì™„ë£Œ</button>
    <button id="btnNot" class="toggle-btn active">ë¯¸ì™„ë£Œ</button>
  </div>

</div>

<div class="footer">
  <button id="saveBtn">ì €ì¥</button>
</div>


<script>
const BASE_URL = "YOUR_WEBAPP_URL"; // Apps Script WebApp URL

// ì£¼ê¸°ë³„ í•­ëª© ë¦¬ìŠ¤íŠ¸
const itemsMap = {
  "ì£¼ê°„": ["ë°©ì¬ì ê²€","ìœ„ìƒë³µì„¸íƒ","ë¹„ê³µì •ì²­ì†Œ"],
  "ì›”ê°„": ["CCPê²€ì¦í‘œ","ìœ„ìƒêµìœ¡"],
  "ë¶„ê¸°": ["ìê°€í’ˆì§ˆê²€ì‚¬"],
  "ë°˜ê¸°": ["ìš©ìˆ˜íƒ±í¬ì²­ì†Œ","ì—ì–´í•„í„°ì ê²€"],
  "ì—°ê°„": ["ì§€í•˜ìˆ˜ê²€ì‚¬","ê²€êµì •","ìœ íš¨ì„±í‰ê°€"]
};

const dateInput  = document.getElementById("dateInput");
const periodSelect = document.getElementById("periodSelect");
const itemBox = document.getElementById("itemBox");
const itemSelect = document.getElementById("itemSelect");
const statusBox = document.getElementById("statusBox");
const btnDone = document.getElementById("btnDone");
const btnNot = document.getElementById("btnNot");

// ì˜¤ëŠ˜ ë‚ ì§œ ìë™ ì„¤ì •
window.onload = () => {
  dateInput.value = new Date().toISOString().split("T")[0];
};


// ğŸ”¹ ì£¼ê¸° ì„ íƒ ì‹œ
periodSelect.addEventListener("change", () => {
  itemBox.classList.add("hidden");
  statusBox.classList.add("hidden");

  const period = periodSelect.value;
  if (!period) return;

  // í•­ëª© ì´ˆê¸°í™” + "ì„ íƒí•˜ì„¸ìš”" ì¶”ê°€
  itemSelect.innerHTML = `<option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>`;

  itemsMap[period].forEach(item => {
    const op = document.createElement("option");
    op.value = item;
    op.textContent = item;
    itemSelect.appendChild(op);
  });

  itemBox.classList.remove("hidden");
});


// ğŸ”¹ í•­ëª© ì„ íƒ ì‹œ â†’ ìƒíƒœ ë²„íŠ¼ í‘œì‹œ + ì¤‘ë³µ ì¡°íšŒ
itemSelect.addEventListener("change", () => {

  if (itemSelect.value === "") {
    statusBox.classList.add("hidden");
    return;
  }

  statusBox.classList.remove("hidden");

  // ê¸°ë³¸ê°’: ë¯¸ì™„ë£Œ ì„ íƒ
  btnNot.click();

  // ì¤‘ë³µ ì¡°íšŒ
  checkDuplicate();
});


// ìƒíƒœ ë²„íŠ¼ í† ê¸€
btnDone.onclick = () => {
  btnDone.classList.add("active");
  btnDone.classList.remove("inactive");
  btnNot.classList.remove("active");
  btnNot.classList.add("inactive");
};

btnNot.onclick = () => {
  btnNot.classList.add("active");
  btnNot.classList.remove("inactive");
  btnDone.classList.remove("active");
  btnDone.classList.add("inactive");
};


// í˜„ì¬ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
function getStatus() {
  return btnDone.classList.contains("active") ? "ì™„ë£Œ" : "ë¯¸ì™„ë£Œ";
}


// ğŸ”¹ ì¤‘ë³µ ì¡°íšŒ í•¨ìˆ˜
function checkDuplicate() {
  fetch(`${BASE_URL}?mode=read&date=${dateInput.value}&period=${periodSelect.value}&item=${itemSelect.value}`)
    .then(r => r.json())
    .then(d => {
      if (d.status) {
        if (d.data === "ì™„ë£Œ") btnDone.click();
        else btnNot.click();
      }
    });
}


// ğŸ”¹ ì €ì¥ ë²„íŠ¼
saveBtn.onclick = () => {
  if (!periodSelect.value) return alert("ì£¼ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
  if (!itemSelect.value) return alert("í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.");

  const payload = {
    mode:"write",
    date:dateInput.value,
    period:periodSelect.value,
    item:itemSelect.value,
    status:getStatus()
  };

  fetch(BASE_URL, {
    method:"POST",
    body:JSON.stringify(payload)
  })
  .then(r=>r.json())
  .then(d=>alert(d.message));
};
</script>

</body>
</html>
