<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>정기검증 입력</title>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f3f3f3;
  }

  /* 상단 헤더 */
  .header {
    position: fixed;
    top: 0;
    width: 100%;
    background: #1976d2;
    color: white;
    padding: 14px;
    font-size: 20px;
    font-weight: bold;
    text-align: center;
    z-index: 1000;
  }

  /* 본문 영역 */
  .content {
    padding: 20px;
    padding-top: 80px; /* 헤더 높이 보정 */
    padding-bottom: 90px; /* 하단 버튼 보정 */
  }

  /* 하단 저장 버튼 */
  .footer {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #ffffff;
    border-top: 1px solid #ccc;
    padding: 15px;
    text-align: center;
  }

  button.save-btn {
    width: 95%;
    padding: 14px;
    background: #1976d2;
    color: white;
    font-size: 18px;
    border: none;
    border-radius: 8px;
  }

  select, input {
    width: 100%;
    padding: 12px;
    margin-top: 12px;
    font-size: 16px;
  }

  .section-title {
    font-weight: bold;
    margin-top: 25px;
  }

  /* 상태 토글 버튼 */
  .toggle-group {
    display: flex;
    gap: 10px;
    margin-top: 15px;
  }

  .toggle-btn {
    flex: 1;
    padding: 14px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #bbb;
    background: #eee;
    text-align: center;
  }

  .toggle-btn.active {
    background: #1976d2;
    color: white;
  }
</style>

</head>
<body>

<div class="header">정기검증 입력</div>

<div class="content">

  <div class="section-title">날짜</div>
  <input type="date" id="dateInput">

  <div class="section-title">주기 선택</div>
  <select id="cycleSelect">
    <option value="">선택하세요</option>
    <option value="주간">주간</option>
    <option value="월간">월간</option>
    <option value="분기">분기</option>
    <option value="반기">반기</option>
    <option value="연간">연간</option>
  </select>

  <div class="section-title">점검 항목</div>
  <select id="itemSelect" disabled>
    <option value="">주기를 먼저 선택하세요</option>
  </select>

  <div class="section-title">점검 상태</div>
  <div class="toggle-group">
    <div id="btnDone" class="toggle-btn">완료</div>
    <div id="btnNotDone" class="toggle-btn active">미완료</div>
  </div>

</div>

<div class="footer">
  <button class="save-btn" onclick="saveData()">저장하기</button>
</div>


<script>
// ===== API URL =====
const BASE_URL = "YOUR_APPS_SCRIPT_DEPLOY_URL"; // 여기에 본인 Apps Script URL 넣기

// ===== 날짜 기본값 오늘 =====
document.getElementById("dateInput").valueAsDate = new Date();

// ===== 주기에 따른 항목 리스트 =====
const itemsByCycle = {
  "주간": ["방재점검", "위생복세탁", "비공정청소"],
  "월간": ["CCP검증표", "위생교육"],
  "분기": ["자가품질검사"],
  "반기": ["용수탱크청소", "에어필터점검"],
  "연간": ["지하수검사", "검교정", "유효성평가"]
};

// ===== 상태 선택(토글처리) =====
let currentStatus = "미완료";

document.getElementById("btnDone").onclick = () => setStatus("완료");
document.getElementById("btnNotDone").onclick = () => setStatus("미완료");

function setStatus(state) {
  currentStatus = state;
  document.getElementById("btnDone").classList.toggle("active", state === "완료");
  document.getElementById("btnNotDone").classList.toggle("active", state === "미완료");
}

// ===== 주기 선택 시 항목 목록 출력 =====
document.getElementById("cycleSelect").addEventListener("change", () => {
  const cycle = cycleSelect.value;
  const itemSelect = document.getElementById("itemSelect");

  itemSelect.innerHTML = "";

  if (!cycle) {
    itemSelect.disabled = true;
    itemSelect.innerHTML = `<option value="">주기를 먼저 선택하세요</option>`;
    return;
  }

  itemSelect.disabled = false;
  itemSelect.innerHTML = `<option value="">항목 선택</option>`;

  itemsByCycle[cycle].forEach(item => {
    itemSelect.innerHTML += `<option value="${item}">${item}</option>`;
  });
});

// ===== 항목 선택 시 기존 상태 조회 =====
document.getElementById("itemSelect").addEventListener("change", () => {
  checkDuplicate();
});

// ===== 중복조회 =====
async function checkDuplicate() {
  const date = dateInput.value;
  const cycle = cycleSelect.value;
  const item = itemSelect.value;

  if (!date || !cycle || !item) return;

  const url = `${BASE_URL}?mode=check&date=${date}&cycle=${cycle}&item=${item}`;

  const res = await fetch(url);
  const data = await res.json();

  if (data.exists) {
    setStatus(data.status); // 기존 상태 자동 적용
  } else {
    setStatus("미완료"); // 기본값
  }
}

// ===== 저장 =====
async function saveData() {
  const date = dateInput.value;
  const cycle = cycleSelect.value;
  const item = itemSelect.value;

  if (!date || !cycle || !item) {
    alert("모든 항목을 입력하세요.");
    return;
  }

  const payload = {
    mode: "save",
    date,
    cycle,
    item,
    status: currentStatus
  };

  const res = await fetch(BASE_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  });

  const data = await res.json();
  alert(data.message);
}
</script>

</body>
</html>
