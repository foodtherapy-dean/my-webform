<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê¸ˆì†ê²€ì¶œ ì ê²€</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: sans-serif;
      padding: 10px;
      max-width: 600px;
      margin: auto;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
    }
    select, input[type="number"], input[type="text"], input[type="date"] {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .inline-row {
      display: flex;
      gap: 10px;
    }
    .inline-row > * {
      flex: 1;
    }
    .ox-group {
      display: flex;
      gap: 15px;
      margin-bottom: 10px;
    }
    .hidden {
      display: none;
    }
    button {
      padding: 12px;
      width: 100%;
      font-size: 16px;
      background-color: #1e90ff;
      color: white;
      border: none;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h2>ê¸ˆì†ê²€ì¶œ ì ê²€í¼</h2>

  <form id="magnetForm">
    <div class="form-group">
      <label for="date">ë‚ ì§œ</label>
      <input type="date" id="date" name="date" required />
    </div>

    <div class="form-group">
      <label for="time">ì‹œê°„</label>
      <div class="inline-row">
        <input type="number" id="hour" min="0" max="23" placeholder="ì‹œ" required />
        <input type="number" id="minute" min="0" max="59" placeholder="ë¶„" required />
      </div>
    </div>

    <div class="form-group">
      <label for="step">ì ê²€ì˜µì…˜</label>
      <select id="step" name="step" required>
        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="1ì°¨ì ê²€">1ì°¨ì ê²€</option>
        <option value="2ì°¨ì ê²€">2ì°¨ì ê²€</option>
        <option value="3ì°¨ì ê²€">3ì°¨ì ê²€</option>
        <option value="4ì°¨ì ê²€">4ì°¨ì ê²€</option>
        <option value="ìµœì¢…ì·¨í•©">ìµœì¢…ì·¨í•©</option>
      </select>
    </div>

    <div id="productGroup" class="form-group hidden">
      <label for="product">ì œí’ˆì„ íƒ</label>
      <select id="product" name="product">
        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="Aìƒí’ˆ">Aìƒí’ˆ</option>
        <option value="Bìƒí’ˆ">Bìƒí’ˆ</option>
        <option value="Cìƒí’ˆ">Cìƒí’ˆ</option>
        <option value="Dìƒí’ˆ">Dìƒí’ˆ</option>
        <option value="Eìƒí’ˆ">Eìƒí’ˆ</option>
        <option value="Gìƒí’ˆ">Gìƒí’ˆ</option>
      </select>
    </div>

    <div id="oxOptions" class="form-group hidden">
      <label>O/X ì„ íƒ</label>
      <div class="ox-group">
        <label>Fe:
          <select id="fe" required>
            <option value="">ì„ íƒ</option>
            <option value="O">O</option>
            <option value="X">X</option>
          </select>
        </label>
        <label>Sus:
          <select id="sus" required>
            <option value="">ì„ íƒ</option>
            <option value="O">O</option>
            <option value="X">X</option>
          </select>
        </label>
      </div>
      <div class="ox-group">
        <label>ì œí’ˆ:
          <select id="productOnly" required>
            <option value="">ì„ íƒ</option>
            <option value="O">O</option>
            <option value="X">X</option>
          </select>
        </label>
        <label>ì œí’ˆ+Fe:
          <select id="productFe" required>
            <option value="">ì„ íƒ</option>
            <option value="O">O</option>
            <option value="X">X</option>
          </select>
        </label>
        <label>ì œí’ˆ+Sus:
          <select id="productSus" required>
            <option value="">ì„ íƒ</option>
            <option value="O">O</option>
            <option value="X">X</option>
          </select>
        </label>
      </div>
    </div>

    <div id="finalInputs" class="hidden">
      <div class="form-group">
        <label for="passCount">í†µê³¼ìˆ˜ëŸ‰</label>
        <input type="number" id="passCount" min="0" />
      </div>
      <div class="form-group">
        <label for="failCount">ê²€ì¶œìˆ˜ëŸ‰</label>
        <input type="number" id="failCount" min="0" />
      </div>
    </div>

    <button type="submit">ì €ì¥</button>
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // ë‚ ì§œ ìë™ ì„¤ì •
      const today = new Date().toISOString().substr(0, 10);
      document.getElementById("date").value = today;

      const stepSelect = document.getElementById("step");
      const productGroup = document.getElementById("productGroup");
      const oxOptions = document.getElementById("oxOptions");
      const finalInputs = document.getElementById("finalInputs");

      stepSelect.addEventListener("change", () => {
        const val = stepSelect.value;
        const isFinal = val === "ìµœì¢…ì·¨í•©";

        productGroup.classList.remove("hidden");
        oxOptions.classList.toggle("hidden", isFinal);
        finalInputs.classList.toggle("hidden", !isFinal);
      });

      document.getElementById("magnetForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const data = {
          type: "magnet",
          date: document.getElementById("date").value,
          hour: document.getElementById("hour").value,
          minute: document.getElementById("minute").value,
          step: stepSelect.value,
          product: document.getElementById("product").value,
          fe: document.getElementById("fe").value,
          sus: document.getElementById("sus").value,
          productOnly: document.getElementById("productOnly").value,
          productFe: document.getElementById("productFe").value,
          productSus: document.getElementById("productSus").value,
          passCount: document.getElementById("passCount").value,
          failCount: document.getElementById("failCount").value,
        };

        // ìœ íš¨ì„± ê²€ì‚¬
        if (!data.date || !data.hour || !data.minute || !data.step) {
          alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        const isFinal = data.step === "ìµœì¢…ì·¨í•©";
        if (!data.product) {
          alert("ì œí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
          return;
        }

        if (isFinal) {
          if (!data.passCount || !data.failCount) {
            alert("í†µê³¼/ê²€ì¶œ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
          }
        } else {
          if (!data.fe || !data.sus || !data.productOnly || !data.productFe || !data.productSus) {
            alert("O/X í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
          }
        }

        // ì „ì†¡
        try {
          const url = "https://script.google.com/macros/s/AKfycbzu8cE1fqQUvYpF3P4ImOLT2ngWcVPivWgXyfoQ7fpvnqMDgs3nTL5_zB7PSWZuSqFgKw/exec"; // ğŸ” ë³¸ì¸ì˜ Apps Script URLë¡œ ë³€ê²½
          const res = await fetch(url, {
            method: "POST",
            body: new URLSearchParams({ data: JSON.stringify(data) })
          });

          const result = await res.text();
          alert(result);

          // ì…ë ¥ ë¦¬ì…‹
          document.getElementById("hour").value = "";
          document.getElementById("minute").value = "";
          stepSelect.value = "";
          document.getElementById("product").value = "";
          document.getElementById("fe").value = "";
          document.getElementById("sus").value = "";
          document.getElementById("productOnly").value = "";
          document.getElementById("productFe").value = "";
          document.getElementById("productSus").value = "";
          document.getElementById("passCount").value = "";
          document.getElementById("failCount").value = "";

          oxOptions.classList.add("hidden");
          finalInputs.classList.add("hidden");
          productGroup.classList.add("hidden");
        } catch (error) {
          alert("ì €ì¥ ì‹¤íŒ¨: " + error);
        }
      });
    });
  </script>
</body>
</html>
