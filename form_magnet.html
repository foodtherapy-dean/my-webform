<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>금속검출 점검</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: sans-serif;
      padding: 10px;
      max-width: 600px;
      margin: auto;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
    }
    select, input[type="number"], input[type="text"], input[type="date"] {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .inline-row {
      display: flex;
      gap: 10px;
    }
    .inline-row > * {
      flex: 1;
    }
    .ox-group {
      display: flex;
      gap: 15px;
      margin-bottom: 10px;
    }
    .hidden {
      display: none;
    }
    button {
      padding: 12px;
      width: 100%;
      font-size: 16px;
      background-color: #1e90ff;
      color: white;
      border: none;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h2>금속검출 점검폼</h2>

  <form id="magnetForm">
    <div class="form-group">
      <label for="date">날짜</label>
      <input type="date" id="date" name="date" required />
    </div>

    <div class="form-group">
      <label for="time">시간</label>
      <div class="inline-row">
        <input type="number" id="hour" min="0" max="23" placeholder="시" required />
        <input type="number" id="minute" min="0" max="59" placeholder="분" required />
      </div>
    </div>

    <div class="form-group">
      <label for="step">점검옵션</label>
      <select id="step" name="step" required>
        <option value="">선택하세요</option>
        <option value="1차점검">1차점검</option>
        <option value="2차점검">2차점검</option>
        <option value="3차점검">3차점검</option>
        <option value="4차점검">4차점검</option>
        <option value="최종취합">최종취합</option>
      </select>
    </div>

    <div id="productGroup" class="form-group hidden">
      <label for="product">제품선택</label>
      <select id="product" name="product">
        <option value="">선택하세요</option>
        <option value="A상품">A상품</option>
        <option value="B상품">B상품</option>
        <option value="C상품">C상품</option>
        <option value="D상품">D상품</option>
        <option value="E상품">E상품</option>
        <option value="G상품">G상품</option>
      </select>
    </div>

    <div id="oxOptions" class="form-group hidden">
      <label>O/X 선택</label>
      <div class="ox-group">
        <label>Fe:
          <select id="fe" required>
            <option value="">선택</option>
            <option value="O">O</option>
            <option value="X">X</option>
          </select>
        </label>
        <label>Sus:
          <select id="sus" required>
            <option value="">선택</option>
            <option value="O">O</option>
            <option value="X">X</option>
          </select>
        </label>
      </div>
      <div class="ox-group">
        <label>제품:
          <select id="productOnly" required>
            <option value="">선택</option>
            <option value="O">O</option>
            <option value="X">X</option>
          </select>
        </label>
        <label>제품+Fe:
          <select id="productFe" required>
            <option value="">선택</option>
            <option value="O">O</option>
            <option value="X">X</option>
          </select>
        </label>
        <label>제품+Sus:
          <select id="productSus" required>
            <option value="">선택</option>
            <option value="O">O</option>
            <option value="X">X</option>
          </select>
        </label>
      </div>
    </div>

    <div id="finalInputs" class="hidden">
      <div class="form-group">
        <label for="passCount">통과수량</label>
        <input type="number" id="passCount" min="0" />
      </div>
      <div class="form-group">
        <label for="failCount">검출수량</label>
        <input type="number" id="failCount" min="0" />
      </div>
    </div>

    <button type="submit">저장</button>
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // 날짜 자동 설정
      const today = new Date().toISOString().substr(0, 10);
      document.getElementById("date").value = today;

      const stepSelect = document.getElementById("step");
      const productGroup = document.getElementById("productGroup");
      const oxOptions = document.getElementById("oxOptions");
      const finalInputs = document.getElementById("finalInputs");

      stepSelect.addEventListener("change", () => {
        const val = stepSelect.value;
        const isFinal = val === "최종취합";

        productGroup.classList.remove("hidden");
        oxOptions.classList.toggle("hidden", isFinal);
        finalInputs.classList.toggle("hidden", !isFinal);
      });

      document.getElementById("magnetForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const data = {
          type: "magnet",
          date: document.getElementById("date").value,
          hour: document.getElementById("hour").value,
          minute: document.getElementById("minute").value,
          step: stepSelect.value,
          product: document.getElementById("product").value,
          fe: document.getElementById("fe").value,
          sus: document.getElementById("sus").value,
          productOnly: document.getElementById("productOnly").value,
          productFe: document.getElementById("productFe").value,
          productSus: document.getElementById("productSus").value,
          passCount: document.getElementById("passCount").value,
          failCount: document.getElementById("failCount").value,
        };

        // 유효성 검사
        if (!data.date || !data.hour || !data.minute || !data.step) {
          alert("모든 항목을 입력해주세요.");
          return;
        }

        const isFinal = data.step === "최종취합";
        if (!data.product) {
          alert("제품을 선택해주세요.");
          return;
        }

        if (isFinal) {
          if (!data.passCount || !data.failCount) {
            alert("통과/검출 수량을 입력해주세요.");
            return;
          }
        } else {
          if (!data.fe || !data.sus || !data.productOnly || !data.productFe || !data.productSus) {
            alert("O/X 항목을 모두 선택해주세요.");
            return;
          }
        }

        // 전송
        try {
          const url = "https://script.google.com/macros/s/AKfycbzu8cE1fqQUvYpF3P4ImOLT2ngWcVPivWgXyfoQ7fpvnqMDgs3nTL5_zB7PSWZuSqFgKw/exec"; // 🔁 본인의 Apps Script URL로 변경
          const res = await fetch(url, {
            method: "POST",
            body: new URLSearchParams({ data: JSON.stringify(data) })
          });

          const result = await res.text();
          alert(result);

          // 입력 리셋
          document.getElementById("hour").value = "";
          document.getElementById("minute").value = "";
          stepSelect.value = "";
          document.getElementById("product").value = "";
          document.getElementById("fe").value = "";
          document.getElementById("sus").value = "";
          document.getElementById("productOnly").value = "";
          document.getElementById("productFe").value = "";
          document.getElementById("productSus").value = "";
          document.getElementById("passCount").value = "";
          document.getElementById("failCount").value = "";

          oxOptions.classList.add("hidden");
          finalInputs.classList.add("hidden");
          productGroup.classList.add("hidden");
        } catch (error) {
          alert("저장 실패: " + error);
        }
      });
    });
  </script>
</body>
</html>
