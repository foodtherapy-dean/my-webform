<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>금속검출 점검</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    label {
      display: block;
      margin: 12px 0 4px;
    }
    select, input[type="text"], input[type="number"], input[type="date"], button {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      box-sizing: border-box;
      font-size: 16px;
    }
    .inline-row {
      display: flex;
      gap: 10px;
    }
    .inline-row > * {
      flex: 1;
    }
    .hidden {
      display: none;
    }
    .ox-group label {
      font-weight: normal;
      display: inline-block;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h2>금속검출 점검</h2>

  <!-- 날짜 -->
  <label for="date">날짜</label>
  <input type="date" id="date" name="date" />

  <!-- 점검옵션 -->
  <label for="option">점검옵션</label>
  <select id="option" name="option" required>
    <option value="">선택하세요</option>
    <option value="1차점검">1차점검</option>
    <option value="2차점검">2차점검</option>
    <option value="3차점검">3차점검</option>
    <option value="4차점검">4차점검</option>
    <option value="최종취합">최종취합</option>
  </select>

  <!-- 시/분 -->
  <div id="time-section" class="inline-row hidden">
    <div>
      <label for="hour">시</label>
      <input type="number" id="hour" min="0" max="23" placeholder="0~23" />
    </div>
    <div>
      <label for="minute">분</label>
      <input type="number" id="minute" min="0" max="59" placeholder="0~59" />
    </div>
  </div>

  <!-- 제품선택 -->
  <div id="product-section" class="hidden">
    <label for="product">제품선택</label>
    <select id="product">
      <option value="">선택하세요</option>
      <option value="A상품">A상품</option>
      <option value="B상품">B상품</option>
      <option value="C상품">C상품</option>
      <option value="D상품">D상품</option>
      <option value="E상품">E상품</option>
      <option value="G상품">G상품</option>
    </select>
  </div>

  <!-- OX 체크 5세트 -->
  <div id="ox-section" class="hidden">
    <label>Fe</label>
    <div class="ox-group">
      <label><input type="radio" name="fe" value="O" required /> O</label>
      <label><input type="radio" name="fe" value="X" /> X</label>
    </div>

    <label>Sus</label>
    <div class="ox-group">
      <label><input type="radio" name="sus" value="O" required /> O</label>
      <label><input type="radio" name="sus" value="X" /> X</label>
    </div>

    <label>제품</label>
    <div class="ox-group">
      <label><input type="radio" name="productChk" value="O" required /> O</label>
      <label><input type="radio" name="productChk" value="X" /> X</label>
    </div>

    <label>제품+Fe</label>
    <div class="ox-group">
      <label><input type="radio" name="productFe" value="O" required /> O</label>
      <label><input type="radio" name="productFe" value="X" /> X</label>
    </div>

    <label>제품+Sus</label>
    <div class="ox-group">
      <label><input type="radio" name="productSus" value="O" required /> O</label>
      <label><input type="radio" name="productSus" value="X" /> X</label>
    </div>
  </div>

  <!-- 최종취합 전용 -->
  <div id="final-section" class="hidden">
    <label for="passCount">통과수량</label>
    <input type="number" id="passCount" min="0" />
    <label for="failCount">검출수량</label>
    <input type="number" id="failCount" min="0" />
  </div>

  <button onclick="submitForm()">저장</button>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 오늘 날짜 자동 입력
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('date').value = today;

      // 점검옵션 변화 감지
      document.getElementById('option').addEventListener('change', () => {
        const value = document.getElementById('option').value;
        const isCheck = ['1차점검', '2차점검', '3차점검', '4차점검'].includes(value);
        const isFinal = value === '최종취합';

        document.getElementById('time-section').classList.toggle('hidden', !isCheck);
        document.getElementById('product-section').classList.toggle('hidden', !isCheck && !isFinal);
        document.getElementById('ox-section').classList.toggle('hidden', !isCheck);
        document.getElementById('final-section').classList.toggle('hidden', !isFinal);
      });
    });

    function submitForm() {
      const date = document.getElementById('date').value;
      const option = document.getElementById('option').value;

      if (!date || !option) return alert('날짜와 점검옵션은 필수입니다.');

      const data = {
        type: 'magnet',
        date,
        option,
      };

      if (['1차점검', '2차점검', '3차점검', '4차점검'].includes(option)) {
        const hour = document.getElementById('hour').value;
        const minute = document.getElementById('minute').value;
        const product = document.getElementById('product').value;
        const fe = getRadio('fe');
        const sus = getRadio('sus');
        const productChk = getRadio('productChk');
        const productFe = getRadio('productFe');
        const productSus = getRadio('productSus');

        if (!hour || !minute || !product || !fe || !sus || !productChk || !productFe || !productSus) {
          return alert('모든 항목을 입력해주세요.');
        }

        Object.assign(data, { hour, minute, product, fe, sus, productChk, productFe, productSus });

      } else if (option === '최종취합') {
        const product = document.getElementById('product').value;
        const passCount = document.getElementById('passCount').value;
        const failCount = document.getElementById('failCount').value;

        if (!product || !passCount || !failCount) {
          return alert('모든 항목을 입력해주세요.');
        }

        Object.assign(data, { product, passCount, failCount });
      }

      // Google Apps Script Web App URL
      const url = 'https://script.google.com/macros/s/AKfycbzu8cE1fqQUvYpF3P4ImOLT2ngWcVPivWgXyfoQ7fpvnqMDgs3nTL5_zB7PSWZuSqFgKw/exec'; // ⚠️ 이곳에 실제 URL 입력

      fetch(url, {
        method: 'POST',
        body: new URLSearchParams({ data: JSON.stringify(data) }),
      })
      .then(res => res.text())
      .then(response => {
        alert('저장 완료');
        resetForm(option);
      })
      .catch(err => alert('오류: ' + err));
    }

    function getRadio(name) {
      const el = document.querySelector(`input[name="${name}"]:checked`);
      return el ? el.value : '';
    }

    function resetForm(option) {
      document.getElementById('option').value = '';
      document.getElementById('hour').value = '';
      document.getElementById('minute').value = '';
      document.getElementById('product').value = '';
      ['fe', 'sus', 'productChk', 'productFe', 'productSus'].forEach(name => {
        const checked = document.querySelector(`input[name="${name}"]:checked`);
        if (checked) checked.checked = false;
      });
      document.getElementById('passCount').value = '';
      document.getElementById('failCount').value = '';
      // 다시 옵션 초기화해서 숨김처리 적용
      document.getElementById('option').dispatchEvent(new Event('change'));
    }
  </script>
</body>
</html>
