<script>
  document.getElementById("date").valueAsDate = new Date();

  function handleOptionChange() {
    const option = document.getElementById("option").value;
    const productSection = document.getElementById("productSection");
    const oxSection = document.getElementById("oxSection");
    const finalSection = document.getElementById("finalSection");

    if (option === "최종취합") {
      productSection.classList.remove("hidden");
      oxSection.classList.add("hidden");
      finalSection.classList.remove("hidden");
    } else if (["1차점검", "2차점검", "3차점검", "4차점검"].includes(option)) {
      productSection.classList.remove("hidden");
      oxSection.classList.remove("hidden");
      finalSection.classList.add("hidden");
    } else {
      productSection.classList.add("hidden");
      oxSection.classList.add("hidden");
      finalSection.classList.add("hidden");
    }
  }

  function handleSubmit() {
    const date = document.getElementById("date").value;
    const option = document.getElementById("option").value;
    const product = document.getElementById("product").value;
    const pass = document.getElementById("pass").value;
    const fail = document.getElementById("fail").value;

    const fe = document.querySelector('input[name="fe"]:checked')?.value || "";
    const sus = document.querySelector('input[name="sus"]:checked')?.value || "";
    const prod = document.querySelector('input[name="prod"]:checked')?.value || "";
    const prodfe = document.querySelector('input[name="prodfe"]:checked')?.value || "";
    const prodsus = document.querySelector('input[name="prodsus"]:checked')?.value || "";

    // 필수항목 검증
    if (!option) return alert("점검 옵션을 선택해주세요.");
    if (!product) return alert("제품을 선택해주세요.");

    if (option === "최종취합") {
      if (!pass || !fail) return alert("통과수량과 검출수량을 모두 입력해주세요.");
    } else {
      if (!fe || !sus || !prod || !prodfe || !prodsus) {
        return alert("모든 O/X 항목을 선택해주세요.");
      }
    }

    const data = {
      date, option, product, fe, sus, prod, prodfe, prodsus, pass, fail
    };

    const url = "https://script.google.com/macros/s/AKfycbxxxxx/exec";

    fetch(url, {
      method: "POST",
      body: new URLSearchParams({ magnet: JSON.stringify(data) })
    })
      .then(res => res.text())
      .then(result => {
        alert("✅ 저장되었습니다");
        resetInputs();  // 입력값 리셋
      })
      .catch(err => alert("⚠️ 저장 오류: " + err));
  }

  function resetInputs() {
    document.getElementById("option").value = "";
    document.getElementById("product").value = "";
    document.getElementById("pass").value = "";
    document.getElementById("fail").value = "";

    document.querySelectorAll('input[type="radio"]').forEach(el => el.checked = false);

    // 숨김 상태 초기화
    document.getElementById("productSection").classList.add("hidden");
    document.getElementById("oxSection").classList.add("hidden");
    document.getElementById("finalSection").classList.add("hidden");
  }
</script>
