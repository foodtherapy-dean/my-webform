<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>금속검출 점검</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 10px;
      max-width: 600px;
      margin: auto;
    }

    .form-section {
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 6px;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      text-align: center;
    }

    .inline-row {
      display: flex;
      gap: 10px;
    }

    .inline-row > div {
      flex: 1;
    }

    .ox-group {
      margin-top: 10px;
    }

    .ox-label {
      text-align: center;
      margin-bottom: 4px;
      font-size: 14px;
    }

    .ox-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .ox-button {
      flex: 1;
      padding: 8px;
      font-size: 16px;
      border: 1px solid #aaa;
      border-radius: 6px;
      cursor: pointer;
      background: #f1f1f1;
    }

    .ox-button.active {
      background: #007bff;
      color: white;
      font-weight: bold;
    }

    button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #ddd;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    .center {
      text-align: center;
    }

    .input-center {
      text-align: center;
    }
  </style>
</head>
<body>
  <h2>금속검출 점검</h2>

  <div class="form-section">
    <label for="date">날짜</label>
    <input type="date" id="date" />
  </div>

  <div class="form-section">
    <label for="inspection">점검 옵션</label>
    <select id="inspection">
      <option value="">선택하세요</option>
      <option value="1차점검">1차점검</option>
      <option value="2차점검">2차점검</option>
      <option value="3차점검">3차점검</option>
      <option value="최종취합">최종취합</option>
    </select>
  </div>

  <div id="details" class="hidden">
    <div class="form-section inline-row">
      <div>
        <label>시</label>
        <select id="hour">
          ${[...Array(24).keys()].map(i => `<option value="${i}">${i}</option>`).join("")}
        </select>
      </div>
      <div>
        <label>분</label>
        <select id="minute">
          ${[0,10,20,30,40,50].map(i => `<option value="${i}">${i}</option>`).join("")}
        </select>
      </div>
    </div>

    <div class="form-section">
      <label for="product">제품명</label>
      <select id="product">
        <option value="">선택하세요</option>
        <option>제품A</option>
        <option>제품B</option>
        <option>제품C</option>
        <option>제품D</option>
        <option>제품E</option>
        <option>제품F</option>
      </select>
    </div>

    <div id="oxSection" class="form-section">
      ${["자석검출", "금속검출", "테스트완료", "작업자확인", "기기정상"]
        .map((label, i) => `
        <div class="ox-group">
          <div class="ox-label">${label}</div>
          <div class="ox-buttons" data-label="${label}">
            <button type="button" class="ox-button" data-value="O">O</button>
            <button type="button" class="ox-button" data-value="X">X</button>
          </div>
        </div>
      `).join("")}
    </div>

    <div id="finalSection" class="form-section hidden">
      <div class="inline-row">
        <div>
          <label>검출 수량</label>
          <input type="number" id="failCount" class="input-center" />
        </div>
        <div>
          <label>통과 수량</label>
          <input type="number" id="passCount" class="input-center" />
        </div>
      </div>
    </div>
  </div>

  <button onclick="submitForm()">저장</button>

  <script>
    const inspection = document.getElementById("inspection");
    const details = document.getElementById("details");
    const finalSection = document.getElementById("finalSection");

    inspection.addEventListener("change", () => {
      const show = inspection.value !== "";
      details.classList.toggle("hidden", !show);
      finalSection.classList.toggle("hidden", inspection.value !== "최종취합");
    });

    document.querySelectorAll(".ox-buttons").forEach(group => {
      const buttons = group.querySelectorAll(".ox-button");
      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          buttons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
        });
      });
    });

    function submitForm() {
      const data = {
        type: "magnet",
        date: document.getElementById("date").value,
        option: inspection.value,
        hour: document.getElementById("hour").value,
        minute: document.getElementById("minute").value,
        product: document.getElementById("product").value,
        ox: {},
        passCount: document.getElementById("passCount").value,
        failCount: document.getElementById("failCount").value
      };

      document.querySelectorAll(".ox-buttons").forEach(group => {
        const label = group.dataset.label;
        const selected = group.querySelector(".active");
        data.ox[label] = selected ? selected.textContent : "";
      });

      fetch("https://script.google.com/macros/s/AKfycbxPop9R_o9wIyfq1-fFV1LBkkKMBJYxoEj5dA3e8r_e_Jj2ktuNAR8qo1FwA2Hk8iJUvA/exec", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "data=" + encodeURIComponent(JSON.stringify(data))
      })
      .then(res => res.text())
      .then(msg => alert(msg))
      .catch(err => alert("에러 발생: " + err));
    }
  </script>
</body>
</html>
