<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>정기검증 입력폼</title>
<link rel="icon" type="image/png" sizes="192x192" href="icon.png">
<meta name="theme-color" content="#4CAF50">
<style>
body, html { margin:0; padding:0; height:100%; font-family:sans-serif; }
.app-container { display:flex; flex-direction:column; height:100%; }
.app-header { background:#4CAF50; color:#fff; text-align:center; padding:16px; font-size:1.4rem; font-weight:bold; }
.app-body { flex:1 1 auto; overflow-y:auto; padding:16px; box-sizing:border-box; background:#f9f9f9; }
.input-box { background:white; padding:14px; margin-bottom:12px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
select, input[type="date"] { width:100%; padding:10px; font-size:16px; margin-top:6px; border-radius:6px; border:1px solid #ccc; }
.toggle-row { display:flex; gap:10px; margin-top:12px; }
.toggle-btn { flex:1; padding:14px 0; font-size:16px; border-radius:10px; border:1px solid #ccc; cursor:pointer; text-align:center; }
.toggle-btn.active { background:#4CAF50; color:white; border:none; }
.toggle-btn.inactive { background:#f44336; color:white; border:none; }
.toggle-btn.default { background:none; color:#333; border:1px solid #ccc; }
.app-footer { flex:0 0 auto; }
#saveBtn { width:100%; font-size:1.4rem; padding:16px 0; background:#4CAF50; color:#fff; border:none; cursor:pointer; border-radius:0; }
</style>
</head>
<body>
<div class="app-container">
  <div class="app-header">정기검증 입력폼</div>

  <div class="app-body">
    <div class="input-box">
      <label>날짜</label>
      <input type="date" id="dateInput" />
    </div>

    <div class="input-box">
      <label>주기 선택</label>
      <select id="periodSelect">
        <option value="">-- 선택하세요 --</option>
        <option value="주간">주간</option>
        <option value="월간">월간</option>
        <option value="분기">분기</option>
        <option value="반기">반기</option>
        <option value="연간">연간</option>
      </select>
    </div>

    <div class="input-box hidden" id="itemBox">
      <label>항목 선택</label>
      <select id="itemSelect">
        <option value="">-- 선택하세요 --</option>
      </select>
    </div>

    <div class="input-box hidden" id="statusBox">
      <label>점검상태</label>
      <div class="toggle-row">
        <div id="btnDone" class="toggle-btn default">완료</div>
        <div id="btnNot" class="toggle-btn active">미완료</div>
      </div>
    </div>
  </div>

  <div class="app-footer">
    <button id="saveBtn">저장</button>
  </div>
</div>

<script>
const BASE_URL = "YOUR_WEBAPP_URL";

const itemsMap = {
  "주간": ["방재점검","위생복세탁","비공정청소"],
  "월간": ["CCP검증표","위생교육"],
  "분기": ["자가품질검사"],
  "반기": ["용수탱크청소","에어필터점검"],
  "연간": ["지하수검사","검교정","유효성평가"]
};

const dateInput = document.getElementById("dateInput");
const periodSelect = document.getElementById("periodSelect");
const itemBox = document.getElementById("itemBox");
const itemSelect = document.getElementById("itemSelect");
const statusBox = document.getElementById("statusBox");
const btnDone = document.getElementById("btnDone");
const btnNot = document.getElementById("btnNot");
const saveBtn = document.getElementById("saveBtn");

// 초기 날짜
window.onload = () => { dateInput.value = new Date().toISOString().split("T")[0]; };

// 주기 선택
periodSelect.addEventListener("change", () => {
  itemBox.classList.add("hidden");
  statusBox.classList.add("hidden");
  const period = periodSelect.value;
  if (!period) return;
  itemSelect.innerHTML = '<option value="">-- 선택하세요 --</option>';
  itemsMap[period].forEach(i => { let op=document.createElement("option"); op.value=i; op.textContent=i; itemSelect.appendChild(op); });
  itemBox.classList.remove("hidden");
});

// 항목 선택
itemSelect.addEventListener("change", () => {
  if (!itemSelect.value) { statusBox.classList.add("hidden"); return; }
  statusBox.classList.remove("hidden");
  btnNot.className = "toggle-btn active"; // 기본: 미완료
  btnDone.className = "toggle-btn default";
  checkDuplicate();
});

// 버튼 토글
btnDone.onclick = () => { btnDone.className="toggle-btn active"; btnNot.className="toggle-btn default"; };
btnNot.onclick = () => { btnNot.className="toggle-btn active"; btnDone.className="toggle-btn default"; };

function getStatus() { return btnDone.classList.contains("active")?"완료":"미완료"; }

// 중복 조회
function checkDuplicate() {
  fetch(`${BASE_URL}?mode=read&date=${dateInput.value}&period=${periodSelect.value}&item=${itemSelect.value}`)
    .then(r=>r.json())
    .then(d=>{
      if(d.status){
        if(d.data==="완료") btnDone.click(); else btnNot.click();
      }
    });
}

// 저장
saveBtn.onclick = () => {
  if(!periodSelect.value){ alert("주기를 선택하세요."); return; }
  if(!itemSelect.value){ alert("항목을 선택하세요."); return; }
  if(!getStatus()){ alert("점검상태를 선택하세요."); return; }

  const payload = {
    mode:"write",
    date:dateInput.value,
    period:periodSelect.value,
    item:itemSelect.value,
    status:getStatus()
  };
  fetch(BASE_URL,{ method:"POST", body:JSON.stringify(payload) })
    .then(r=>r.json()).then(d=>alert(d.message));
};
</script>
</body>
</html>
