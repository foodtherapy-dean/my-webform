<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>월별 점검</title>
<style>
  table { border-collapse: collapse; width: 100%; text-align: center; }
  th, td { border: 1px solid #999; padding: 4px; }
</style>
</head>
<body>
<h3>월별 점검</h3>
<label for="yearSelect">년도:</label>
<select id="yearSelect"></select>
<button onclick="loadMonthly()">조회</button>
<table>
  <thead>
    <tr>
      <th rowspan="2">월</th>
      <th>분기</th>
      <th colspan="2">반기</th>
      <th colspan="3">연간</th>
    </tr>
    <tr>
      <th>품질검사</th>
      <th>탱크청소</th>
      <th>에어필터</th>
      <th>지하수검사</th>
      <th>검교정</th>
      <th>유효성평가</th>
    </tr>
  </thead>
  <tbody id="monthTableBody"></tbody>
</table>

<script>
const BASE_URL = "https://script.google.com/macros/s/AKfycbxXHby92qoccnlrQ1t8mNyq2jEUTM3hn8TnywpbeU2KXHs6NWZy7wHkkRm1uoxrPm3H7g/exec";

// 년도 선택 옵션
const yearSelect = document.getElementById("yearSelect");
const thisYear = new Date().getFullYear();
for(let y=thisYear-5;y<=thisYear+1;y++){
  const opt = document.createElement("option"); opt.value=y; opt.textContent=y;
  if(y===thisYear) opt.selected=true;
  yearSelect.appendChild(opt);
}

async function loadMonthly() {
  const year = yearSelect.value;
  const res = await fetch(`${BASE_URL}?mode=data_month&year=${year}`);
  const json = await res.json();
  if(!json.success){ alert("데이터 로드 실패"); return; }

  const tbody = document.getElementById("monthTableBody");
  tbody.innerHTML = "";
  json.data.forEach(row=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${row.month}월</td>` + row.statusArray.map(s=>`<td>${s.status}</td>`).join("");
    tbody.appendChild(tr);
  });
}

// 초기 로드
loadMonthly();
</script>
</body>
</html>
