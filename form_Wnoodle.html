<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÏÉùÎ©¥Í≥µÏ†ï Ï†êÍ≤Ä</title>
<style>
  body {
    font-family: sans-serif;
    margin: 0; padding: 0;
    display: flex; flex-direction: column;
    height: 100vh;
  }
  header {
    background: #1976d2; color: #fff;
    padding: 12px; font-size: 18px; text-align: center;
  }
  main {
    flex: 1; overflow-y: auto;
    padding: 12px;
  }
  table {
    width: 100%; border-collapse: collapse;
  }
  td {
    border-bottom: 1px solid #ddd;
    padding: 6px;
    text-align: center;
  }
  .round-btn {
    padding: 6px 12px;
    margin: 0 4px;
    border-radius: 12px;
    border: 1px solid #1976d2;
    background: #fff;
    color: #1976d2;
    cursor: pointer;
  }
  .round-btn.active {
    background: #1976d2;
    color: #fff;
  }
  .result {
    font-weight: bold;
    color: #333;
  }
  footer {
    background: #fff;
    border-top: 1px solid #ccc;
    padding: 10px;
    text-align: center;
  }
  button.save-btn {
    width: 90%;
    padding: 12px;
    font-size: 16px;
    background: #1976d2; color: #fff;
    border: none; border-radius: 8px;
    cursor: pointer;
  }
</style>
</head>
<body>
  <header>ÏÉùÎ©¥Í≥µÏ†ï Ï†êÍ≤Ä</header>
  <main>
    <label>üìÖ ÎÇ†Ïßú:
      <input type="date" id="dateInput">
    </label>
    <table id="checkTable">
      <tbody>
        <!-- JSÏóêÏÑú 1Ï∞®~10Ï∞® ÏûêÎèô ÏÉùÏÑ± -->
      </tbody>
    </table>
  </main>
  <footer>
    <button class="save-btn" onclick="saveData()">Ï†ÄÏû•</button>
  </footer>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzuT-_RAwyZvrq8GmRmHcR8G3LI8u4xiqOw4SmMEqVOfOeJ-kNH5BCaS6nKsjK3WyDBtA/exec";

document.addEventListener("DOMContentLoaded", () => {
  const today = new Date().toISOString().split("T")[0];
  document.getElementById("dateInput").value = today;

  const tbody = document.querySelector("#checkTable tbody");
  for (let i = 1; i <= 10; i++) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="phase-label" data-index="${i}">${i}Ï∞®</td>
      <td>
        <button class="round-btn" data-phase="${i}" data-value="3Ìè¨">3Ìè¨</button>
        <button class="round-btn" data-phase="${i}" data-value="2Ìè¨">2Ìè¨</button>
      </td>
      <td class="result" id="result-${i}"></td>
    `;
    tbody.appendChild(tr);
  }

  // Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
  tbody.addEventListener("click", (e) => {
    if (e.target.classList.contains("round-btn")) {
      const phase = e.target.dataset.phase;
      const value = e.target.dataset.value;
      // Î™®Îì† Î≤ÑÌäº Ï¥àÍ∏∞Ìôî ÌõÑ ÏÑ†ÌÉù ÌëúÏãú
      document.querySelectorAll(`button[data-phase="${phase}"]`).forEach(b => b.classList.remove("active"));
      e.target.classList.add("active");
      document.getElementById(`result-${phase}`).innerText = value;
    }
    if (e.target.classList.contains("phase-label")) {
      const idx = e.target.dataset.index;
      // Î≤ÑÌäº, Í≤∞Í≥º Ï¥àÍ∏∞Ìôî
      document.querySelectorAll(`button[data-phase="${idx}"]`).forEach(b => b.classList.remove("active"));
      document.getElementById(`result-${idx}`).innerText = "";
    }
  });
});

function collectData() {
  const date = document.getElementById("dateInput").value;
  let no = [], value = [];
  for (let i = 1; i <= 10; i++) {
    const result = document.getElementById(`result-${i}`).innerText;
    no.push(result ? i : "");
    value.push(result || "");
  }
  return { date, no, value };
}

function saveData() {
  const data = collectData();
  if (!data.date) {
    alert("ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.");
    return;
  }

  // 1Ô∏è‚É£ Î®ºÏ†Ä Ï§ëÎ≥µ Ï≤¥ÌÅ¨
  fetch(scriptURL + "?checkSaengmyeon=" + encodeURIComponent(JSON.stringify({ date: data.date })))
    .then(res => res.json())
    .then(check => {
      if (check.exists) {
        if (confirm("Ïù¥ÎØ∏ Ìï¥Îãπ ÎÇ†Ïßú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏäµÎãàÎã§.\nÏßÑÌñâ = ÎçÆÏñ¥Ïì∞Í∏∞ / Ï∑®ÏÜå = Ï¥àÍ∏∞Ìôî")) {
          postData(data); // ÎçÆÏñ¥Ïì∞Í∏∞
        } else {
          resetForm();
        }
      } else {
        postData(data); // Ïã†Í∑ú Ï†ÄÏû•
      }
    })
    .catch(err => alert("Ï§ëÎ≥µ ÌôïÏù∏ Ïò§Î•ò: " + err));
}

function postData(data) {
  fetch(scriptURL, {
    method: "POST",
    body: new URLSearchParams({ saengmyeon: JSON.stringify(data) })
  })
  .then(res => res.text())
  .then(txt => {
    alert("Ï†ÄÏû• ÏôÑÎ£å: " + txt);
    resetForm();
  })
  .catch(err => alert("Ï†ÄÏû• Ïò§Î•ò: " + err));
}

function resetForm() {
  document.querySelectorAll(".round-btn").forEach(b => b.classList.remove("active"));
  document.querySelectorAll(".result").forEach(r => r.innerText = "");
}
</script>
</body>
</html>
