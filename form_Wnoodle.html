<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ìƒë©´ê³µì • ì…ë ¥</title>
<style>
body, html {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: sans-serif;
}
.app-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}
.app-header {
  background-color: #4CAF50;
  color: white;
  text-align: center;
  padding: 20px;
  font-size: 2rem;
  flex: 0 0 auto;
}
.app-body {
  flex: 1 1 auto;
  overflow-y: auto;
  padding: 20px;
  box-sizing: border-box;
  background-color: #f9f9f9;
}
.app-footer {
  flex: 0 0 auto;
}
#submitBtn {
  width: 100%;
  font-size: 1.8rem;
  padding: 24px 0;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 0;
  cursor: pointer;
}
.row {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  margin-bottom: 12px;
  background: #fff;
  padding: 16px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  flex-wrap: nowrap;
}
.label {
  width: 60px;
  font-weight: bold;
  font-size: 1.4rem;
}
.btn {
  flex: 1;
  margin: 0 8px;
  padding: 16px;
  border-radius: 8px;
  cursor: pointer;
  border: none;
  font-size: 1.4rem;
  font-weight: bold;
  background: #e0e0e0; /* ê¸°ë³¸ íšŒìƒ‰ */
  color: #333;
  transition: background 0.2s, color 0.2s;
}
.btn.selected {
  background: #4CAF50; /* ì„ íƒ ì‹œ ê³µí†µ ì´ˆë¡ */
  color: white;
}

/* ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ */
@media (max-width: 768px) {
  .row {
    flex-wrap: wrap;  /* ë²„íŠ¼ê³¼ ê²°ê³¼ê°€ í•œ ì¤„ì— ìœ ì§€ë˜ë„ë¡ */
  }
  .label {
    font-size: 1.6rem;
  }
  .btn {
    font-size: 1.6rem;
    padding: 16px 0;
  }
  .result {
    font-size: 1.6rem;
    text-align: right;
    flex: 1; /* ê²°ê³¼ê°€ ì˜¤ë¥¸ìª½ ëìœ¼ë¡œ */
  }
}


/* ì¤‘ë³µ ë©”ì‹œì§€ */
#duplicateMsg {
  display: none;
  background-color: #ffcccc;
  color: #900;
  padding: 14px;
  margin-top: 8px;
  border: 1px solid #900;
  border-radius: 6px;
  font-weight: bold;
  font-size: 1.2rem;
}
#duplicateMsg button {
  margin-left: 14px;
  background-color: #900;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
}
/* ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ */
@media (max-width: 768px) {
  .row {
    flex-direction: column;
    align-items: stretch;
  }
  .label {
    width: 100%;
    font-size: 1.6rem;
    margin-bottom: 10px;
  }
  .btn {
    width: 100%;
    margin: 5px 0;
    font-size: 1.6rem;
    padding: 16px 0;
  }
  .result {
    font-size: 1.6rem;
    text-align: center;
  }
}
</style>
</head>
<body>
<div class="app-container">
  <div class="app-header">ìƒë©´ê³µì • ì ê²€ ì…ë ¥</div>

  <div class="app-body">
    <!-- ë‚ ì§œ -->
    <label for="date">ë‚ ì§œ</label>
    <input type="date" id="date" required style="font-size:1.4rem; padding:10px; width:100%; margin-bottom:20px;" />

    <!-- 1ì°¨~10ì°¨ -->
    <h3 style="margin-top:20px;">ì°¨ìˆ˜ë³„ ì…ë ¥</h3>
    <div id="rounds"></div>

    <!-- ì¤‘ë³µ ë©”ì‹œì§€ -->
    <div id="duplicateMsg">
      <span id="duplicateText"></span>
      <button id="duplicateConfirmBtn">í™•ì¸</button>
    </div>
  </div>

  <div class="app-footer">
    <button id="submitBtn">ğŸ“¥ ì €ì¥í•˜ê¸°</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const dateInput = document.getElementById("date");
  const submitBtn = document.getElementById("submitBtn");
  const roundsDiv = document.getElementById("rounds");
  const duplicateMsg = document.getElementById("duplicateMsg");
  const duplicateText = document.getElementById("duplicateText");
  const duplicateConfirmBtn = document.getElementById("duplicateConfirmBtn");

  const scriptUrl = "https://script.google.com/macros/s/AKfycbzuT-_RAwyZvrq8GmRmHcR8G3LI8u4xiqOw4SmMEqVOfOeJ-kNH5BCaS6nKsjK3WyDBtA/exec";

  // ì˜¤ëŠ˜ ë‚ ì§œ ìë™
  dateInput.valueAsDate = new Date();

  // ë°ì´í„° ì €ì¥ìš©
  let roundData = {};

  // UI ìƒì„±
  for (let i = 1; i <= 10; i++) {
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <div class="label">${i}ì°¨</div>
      <button class="btn btn-3" onclick="selectOption(${i}, '3í¬')">3í¬</button>
      <button class="btn btn-2" onclick="selectOption(${i}, '2í¬')">2í¬</button>
      <div id="result${i}" class="result"></div>
    `;
    roundsDiv.appendChild(row);
  }

 window.selectOption = function(round, type) {
  let no, value;
  if (type === "3í¬") { no = 60; value = 1; }
  else { no = 40; value = 0.7; }

  roundData[round] = { no, value };

  // ê²°ê³¼ í…ìŠ¤íŠ¸ í‘œì‹œ
  document.getElementById("result"+round).textContent = `ì£¼ì • ${value} kg`;

  // ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸ ì²˜ë¦¬
  const rowBtns = document.querySelectorAll(`#rounds .row:nth-child(${round}) .btn`);
  rowBtns.forEach(btn => btn.classList.remove("selected"));
  if (type === "3í¬") rowBtns[0].classList.add("selected");
  else rowBtns[1].classList.add("selected");
}



  // ì¤‘ë³µ í™•ì¸
  async function checkDuplicate(date) {
    try {
      const res = await fetch(`${scriptUrl}?checkDate=${encodeURIComponent(date)}`);
      const data = await res.json();
      if (data.exists) {
        duplicateText.textContent = `âš ï¸ ${date} ì— ì´ë¯¸ ì…ë ¥ëœ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤.`;
        duplicateMsg.style.display = "block";
        submitBtn.disabled = true;
      } else {
        duplicateMsg.style.display = "none";
        submitBtn.disabled = false;
      }
    } catch (err) {
      console.error("ì¤‘ë³µ í™•ì¸ ì‹¤íŒ¨:", err);
    }
  }

  dateInput.addEventListener("change", () => {
    if (dateInput.value) checkDuplicate(dateInput.value);
  });

  duplicateConfirmBtn.addEventListener("click", () => {
    duplicateMsg.style.display = "none";
    submitBtn.disabled = false; // ê°•ì œ ì…ë ¥ í—ˆìš©
  });

  // ì €ì¥
  submitBtn.addEventListener("click", async () => {
  if (!dateInput.value) { alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”."); return; }

  const noArr = [], valueArr = [];
  for (let i = 1; i <= 10; i++) {
    if (roundData[i]) {
      noArr.push(roundData[i].no);
      valueArr.push(roundData[i].value);
    } else {
      noArr.push("");
      valueArr.push("");
    }
  }

  const data = {
    date: dateInput.value,
    no: noArr,
    value: valueArr
  };

  try {
    const res = await fetch(scriptUrl, {
      method: "POST",
      body: JSON.stringify(data),
      headers: { "Content-Type": "application/json" }
    });
    const text = await res.text();
    alert("ì €ì¥ ì™„ë£Œ: " + text);

    // âœ… ì €ì¥ ì„±ê³µ í›„ ì´ˆê¸°í™”
    roundData = {};
    document.querySelectorAll(".result").forEach(el => el.textContent = "");
    document.querySelectorAll(".btn").forEach(btn => btn.classList.remove("selected"));
    dateInput.valueAsDate = new Date();
  } catch (err) {
    alert("ì—ëŸ¬ ë°œìƒ: " + err.message);
  }
});

  // ì´ˆê¸° ì¤‘ë³µ í™•ì¸
  if (dateInput.value) checkDuplicate(dateInput.value);
});
</script>
</body>
</html>
