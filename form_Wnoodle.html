<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>생면공정 입력폼</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .row { display: flex; align-items: center; margin-bottom: 8px; }
    .label { width: 40px; font-weight: bold; }
    .btn { margin: 0 5px; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
    .btn-3 { background: #4CAF50; color: white; }
    .btn-2 { background: #2196F3; color: white; }
    .result { margin-left: 10px; min-width: 120px; }
    #saveBtn { margin-top: 20px; padding: 10px 20px; font-size: 16px; border-radius: 8px; background: #ff9800; color: white; cursor: pointer; }
  </style>
</head>
<body>
  <h2>생면공정 입력폼</h2>
  <div>
    <label>날짜:</label>
    <input type="date" id="dateInput">
  </div>
  <hr>

  <div id="rounds"></div>

  <button id="saveBtn">저장</button>

  <script>
    // 오늘 날짜 자동 세팅
    document.getElementById("dateInput").valueAsDate = new Date();

    const roundsDiv = document.getElementById("rounds");
    const roundData = {}; // {1: {no:60, value:1}, ...}

    // 1차~10차 버튼 UI 생성
    for (let i = 1; i <= 10; i++) {
      const row = document.createElement("div");
      row.className = "row";
      row.innerHTML = `
        <div class="label">${i}차</div>
        <button class="btn btn-3" onclick="selectOption(${i}, '3포')">3포</button>
        <button class="btn btn-2" onclick="selectOption(${i}, '2포')">2포</button>
        <div id="result${i}" class="result"></div>
      `;
      roundsDiv.appendChild(row);
    }

    function selectOption(round, type) {
      let no, value;
      if (type === "3포") {
        no = 60; value = 1;
      } else {
        no = 40; value = 0.7;
      }
      roundData[round] = { no, value };
      document.getElementById("result" + round).textContent = `주정 ${value} kg`;
    }

    // 저장 버튼 → Apps Script로 전송
    document.getElementById("saveBtn").addEventListener("click", () => {
      const date = document.getElementById("dateInput").value;
      if (!date) { alert("날짜를 선택하세요."); return; }

      // No1~No10, value1~value10 배열 구성
      const noArr = [];
      const valueArr = [];
      for (let i = 1; i <= 10; i++) {
        if (roundData[i]) {
          noArr.push(roundData[i].no);
          valueArr.push(roundData[i].value);
        } else {
          noArr.push("");     // 선택 안했으면 빈칸
          valueArr.push("");
        }
      }

      const data = {
        date: date,
        no: noArr,
        value: valueArr
      };

      fetch("https://script.google.com/macros/s/AKfycbzuT-_RAwyZvrq8GmRmHcR8G3LI8u4xiqOw4SmMEqVOfOeJ-kNH5BCaS6nKsjK3WyDBtA/exec", {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.text())
      .then(msg => alert("저장 완료: " + msg))
      .catch(err => alert("에러 발생: " + err));
    });
  </script>
</body>
</html>
