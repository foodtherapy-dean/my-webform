<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>건조공정 모니터링</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    label, select, input, button { display: block; width: 100%; margin: 10px 0; padding: 8px; font-size: 16px; }
    .section { display: none; margin: 15px 0; padding: 10px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; }
    .visible { display: block; }
  </style>
</head>
<body>
  <h2>건조공정 점검 입력</h2>

  <form id="trapForm">
    <label for="date">점검일자</label>
    <input type="date" id="date" name="date" required>

    <label for="group">점검옵션</label>
    <select id="group" name="group" required>
      <option value="">-- 점검항목 선택 --</option>
      <option value="건조기1">건조기1</option>
      <option value="건조기2">건조기2</option>
      <option value="선별기">선별기</option>
    </select>

    <!-- 건조기1 입력 항목 -->
    <div class="section" id="section-건조기1">
      <label>건조기1 점검내용</label>
      <select name="category">
        <option value="이상 없음">이상 없음</option>
        <option value="청소 필요">청소 필요</option>
        <option value="이상 있음">이상 있음</option>
      </select>
      <input type="text" name="subcategory" placeholder="비고 (선택)">
      <input type="number" name="value" placeholder="수치 (선택)">
    </div>

    <!-- 건조기2 입력 항목 -->
    <div class="section" id="section-건조기2">
      <label>건조기2 점검내용</label>
      <select name="category">
        <option value="정상">정상</option>
        <option value="필터 이상">필터 이상</option>
        <option value="온도 이상">온도 이상</option>
      </select>
      <input type="text" name="subcategory" placeholder="비고 (선택)">
      <input type="number" name="value" placeholder="수치 (선택)">
    </div>

    <!-- 선별기 입력 항목 -->
    <div class="section" id="section-선별기">
      <label>선별기 점검내용</label>
      <select name="category">
        <option value="양호">양호</option>
        <option value="이물 혼입">이물 혼입</option>
        <option value="파손">파손</option>
      </select>
      <input type="text" name="subcategory" placeholder="비고 (선택)">
      <input type="number" name="value" placeholder="수치 (선택)">
    </div>

    <button type="submit">✅ 서버로 전송</button>
  </form>

  <script>
    const groupSelect = document.getElementById("group");
    const sections = {
      "건조기1": document.getElementById("section-건조기1"),
      "건조기2": document.getElementById("section-건조기2"),
      "선별기": document.getElementById("section-선별기")
    };

    function hideAllSections() {
      Object.values(sections).forEach(section => section.classList.remove("visible"));
    }

    groupSelect.addEventListener("change", () => {
      hideAllSections();
      const selected = groupSelect.value;
      if (sections[selected]) {
        sections[selected].classList.add("visible");
      }
    });

    document.getElementById("trapForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const date = document.getElementById("date").value;
      const group = groupSelect.value;
      if (!date || !group) {
        alert("날짜와 점검옵션을 선택해주세요.");
        return;
      }

      const section = sections[group];
      if (!section) {
        alert("해당 점검 섹션이 없습니다.");
        return;
      }

      const inputs = section.querySelectorAll("select, input");
      const entries = {};
      inputs.forEach(input => {
        entries[input.name] = input.value;
      });

      const formData = new FormData();
      formData.append("data", JSON.stringify({ date, group, ...entries }));

      const scriptUrl = "https://script.google.com/macros/s/AKfycbwd9w4SCRYZAKPugiBTy5ede00RFprNBez0In8kb1roiPNkejo1z4zMPDcEQd3khWY1eg/exec";

      fetch(scriptUrl, {
        method: "POST",
        body: formData
      })
      .then(response => response.text())
      .then(result => {
        alert("✅ Google Sheet 저장 완료!\n\n" + result);
        document.getElementById("trapForm").reset();
        hideAllSections();
        groupSelect.dispatchEvent(new Event("change")); // reset 이후 섹션 표시
      })
      .catch(err => {
        alert("❌ 저장 중 오류 발생:\n\n" + err.message);
      });
    });
  </script>
</body>
</html>
